<!DOCTYPE html>
<html lang="en">

<head>
      <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/core.css" rel="stylesheet">
    <link href="css/meal.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Muli:400,400italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,300,900' rel='stylesheet' type='text/css'>
    <script src="js/jquery.js"></script>
    <script src="js/js-cookie.js"></script>
    <script src="js/api_call.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/babel">
  window.fbAsyncInit = function() {
      FB.init({
        appId      : '828767043907424',
        cookie     : true,  // enable cookies to allow the server to access 
                            // the session
        xfbml      : true,  // parse social plugins on this page
        version    : 'v2.4' // use version 2.2
      });
      FB.Event.subscribe('auth.login', function(response) {
        statusChangeCallback(response)
      });
      // FB.getLoginStatus(function(response) {
      //   statusChangeCallback(response);
      // });
  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  
    var login = function() {
      FB.login(fb_handler);
    }
    var fb_handler = function(response) {
        if (response.authResponse) {
            console.log('Welcome!  Fetching your information.... ');
            console.log(response); // dump complete info
            access_token = response.authResponse.accessToken; //get access token
            user_id = response.authResponse.userID; //get FB UID
            var cookie = Cookies.get("session")
            if (cookie === undefined || cookie === "") {
                resp = api_call('kitchenuser', {
                      method: "Login",
                      fbToken: response.authResponse.accessToken
                      });
                if (resp.Success) {
                  console.log("Here is the result: " + resp.Return.Session_token);
                  Cookies.set("session", resp.Return.Session_token, { expires: 50 });
                  console.log("from cookie: " + Cookies.get("session"));
                }
            } else {
                console.log("Didn't call API. from cookie: " + cookie);
            }
            // get the profile pic
            // get the First (and last?) name
            // login in to chakula
        } else {
            //user hit cancel button
            console.log('User cancelled login or did not fully authorize.');

        }
    }
    $(document).ready(function(){
      $('#signin').click(login);
    })
    </script>
</head>
<body>
<nav class="navbar navbar-default navbar-static-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://yaychakula.com/">
        <img class="img-responsive nav-icon" alt="Brand" src="img/chakula_icon.svg" align="left">
      </a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://yaychakula.com/about.html"><span>About</span></a></li>
        <li class="nav-item" id="signin">
            <span class="nav-text">Sign In</span>
            <img class="img-responsive nav-icon" alt="Brand" src="img/user-icon.svg" align="right" />
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
</body>
</html>
